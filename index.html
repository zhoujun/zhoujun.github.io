<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Finger's Blog" type="application/atom+xml" />






<meta name="description" content="Doing it, Feeling it.">
<meta property="og:type" content="website">
<meta property="og:title" content="Finger's Blog">
<meta property="og:url" content="http://fingerchou.com/index.html">
<meta property="og:site_name" content="Finger's Blog">
<meta property="og:description" content="Doing it, Feeling it.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Finger's Blog">
<meta name="twitter:description" content="Doing it, Feeling it.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://fingerchou.com/"/>





  <title>Finger's Blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?f72f3a882d988aa169cd1c83da94a390";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Finger's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fingerchou.com/2019/07/11/python-notes-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Finger Chou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Finger's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/11/python-notes-1/" itemprop="url">Python 杂记(一)</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-11T07:31:00+08:00">
                2019-07-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/11/python-notes-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/07/11/python-notes-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/07/11/python-notes-1/" class="leancloud_visitors" data-flag-title="Python 杂记(一)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="使用slots"><a href="#使用slots" class="headerlink" title="使用slots"></a>使用<strong>slots</strong></h3><p><code>__slots__</code>变量是用来限制class能添加的属性</p>
<p>例如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; class Student(object):</div><div class="line">...     __slots__ = (&apos;name&apos;, &apos;age&apos;) # 用tuple定义允许绑定的属性名称</div><div class="line">...</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; s = Student() # 创建新的实例</div><div class="line">&gt;&gt;&gt; s.name = &apos;Michael&apos; # 绑定属性&apos;name&apos;</div><div class="line">&gt;&gt;&gt; s.age = 25 # 绑定属性&apos;age&apos;</div><div class="line">&gt;&gt;&gt; s.score = 99 # 绑定属性&apos;score&apos;</div><div class="line">Traceback (most recent call last):</div><div class="line">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</div><div class="line">AttributeError: &apos;Student&apos; object has no attribute &apos;score&apos;</div></pre></td></tr></table></figure>
<p>从上面代码示例我们可以看到由于<code>score</code>没有被放到<code>__slots__</code>中，所以不能绑定<code>score</code>属性，试图绑定<code>score</code>将得到AttributeError的错误。<br>使用<code>__slots__</code>要注意，<code>__slots__</code>定义的属性仅对当前类起作用，对继承的子类是不起作用的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; class GraduateStudent(Student):</div><div class="line">...     pass</div><div class="line">...</div><div class="line">&gt;&gt;&gt; g = GraduateStudent()</div><div class="line">&gt;&gt;&gt; g.score = 9999</div></pre></td></tr></table></figure></p>
<p>除非在子类中也定义<code>__slots__</code>，这样，子类允许定义的属性就是自身的<code>__slots__</code>加上父类的<code>__slots__</code>。</p>
<p>详情可以查看廖雪峰教程：<br><a href="https://www.liaoxuefeng.com/wiki/897692888725344/923030542875328" target="_blank" rel="external">https://www.liaoxuefeng.com/wiki/897692888725344/923030542875328</a></p>
<h3 id="关于six-with-metaclass-ABCMeta-object-的理解"><a href="#关于six-with-metaclass-ABCMeta-object-的理解" class="headerlink" title="关于six.with_metaclass(ABCMeta, object)的理解"></a>关于six.with_metaclass(ABCMeta, object)的理解</h3><p>元类就是创建类的类，在Python中，只有type类及其子类才可以当元类，type创建类时，参数格式：type(classname, parentclasses,attrs), classname是类名，字符串类型，parentclasses是类的所有父类，元组类型，attrs是类的所有{属性:值}，是字典类型。一切类的创建最终都会调用type.<strong>new</strong>(cls, classname, bases, attrs)，它会在堆中创建一个类对象，并返回该对象。</p>
<p>当通过type.<strong>new</strong>(cls, classname, bases, attrs)创建类时，cls就是该类的元类，它是type类或其子类。</p>
<p>ABCMeta是一个抽象类的元类，用来创建抽象类基类：Metaclass for defining Abstract Base Classes (ABCs).<br>six.with_metaclass是用元类来创建类的方法，调用一个内部类，在内部类的<strong>new</strong>函数中，返回一个新创建的临时类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">def with_metaclass(meta, *bases):</div><div class="line">    &quot;&quot;&quot;Create a base class with a metaclass.&quot;&quot;&quot;</div><div class="line">    # This requires a bit of explanation: the basic idea is to make a dummy</div><div class="line">    # metaclass for one level of class instantiation that replaces itself with</div><div class="line">    # the actual metaclass.</div><div class="line">    class metaclass(type):</div><div class="line"></div><div class="line">        def __new__(cls, name, this_bases, d):</div><div class="line">            return meta(name, bases, d)</div><div class="line"></div><div class="line">        @classmethod</div><div class="line">        def __prepare__(cls, name, this_bases):</div><div class="line">            return meta.__prepare__(name, bases)</div><div class="line">    return type.__new__(metaclass, ‘temporary_class‘, (), &#123;&#125;)</div></pre></td></tr></table></figure>
<p>six.with_metaclass(ABCMeta, object)就通过内部类的<strong>new</strong>函数返回一个ABCMeta元类创建的临时类，作为PeopleBase类的基类。</p>
<p>在python里类也是对象，下面两个语句可以看PeopleBase类的类型，都是<class 'abc.abcmeta'="">，即PeopleBase类是ABCMeta元类的对象，是由ABCMeta元类生成的。</class></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">print(type(PeopleBase))</div><div class="line">print(PeopleBase.__class__)</div><div class="line">#&lt;class ‘abc.ABCMeta‘&gt;</div><div class="line">#&lt;class ‘abc.ABCMeta‘&gt;</div></pre></td></tr></table></figure>
<p>详情请查看：</p>
<ul>
<li><a href="https://www.cnblogs.com/zhaoshizi/p/9180886.html" target="_blank" rel="external">https://www.cnblogs.com/zhaoshizi/p/9180886.html</a></li>
<li><a href="https://segmentfault.com/a/1190000012530796" target="_blank" rel="external">https://segmentfault.com/a/1190000012530796</a></li>
</ul>
<h3 id="python中MRO排序原理-mro"><a href="#python中MRO排序原理-mro" class="headerlink" title="python中MRO排序原理(mro)"></a>python中MRO排序原理(<strong>mro</strong>)</h3><h4 id="拓扑排序"><a href="#拓扑排序" class="headerlink" title="拓扑排序"></a>拓扑排序</h4><p><img src="/imgs/20190712/1.png" alt=""></p>
<p>如上图所示每个点都是有指向性的：可能指向别人或者被别人指向。</p>
<p>拓扑顺序就是：<strong>每次找到一个只指向别人的点 (学术性说法：入度为0)，记录下来；然后忽略掉这个点和它所指出去的线，再找到下一个只指向别人的点，记录下来，直到剩最后一个点</strong>，所有记录的点的顺序就是拓扑顺序</p>
<p><img src="/imgs/20190712/2.png" alt=""></p>
<p>上图中，只有点1只指向别人，输出1；去掉点1和它伸出的两根线外只有点2只指向别人，输出2；…类推下去，得到拓扑排序结构: 1 2 4 3 5</p>
<h4 id="MRO-排序算法"><a href="#MRO-排序算法" class="headerlink" title="MRO 排序算法"></a>MRO 排序算法</h4><p>MRO 排序应用了 C3 算法，想了解 C3 自己查吧…总之得到的结果类似于拓扑排序，下面有段简单的多继承代码和其对应的拓扑排序的抽象图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">class D(object):</div><div class="line">    pass</div><div class="line"></div><div class="line">class E(object):</div><div class="line">    pass</div><div class="line"> </div><div class="line">class F(object):</div><div class="line">    pass</div><div class="line"> </div><div class="line">class C(D, F):</div><div class="line">    pass</div><div class="line"> </div><div class="line">class B(E, D):</div><div class="line">    pass</div><div class="line"> </div><div class="line">class A(B, C):</div><div class="line">    pass</div><div class="line"> </div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    print A.__mro__</div></pre></td></tr></table></figure>
<p>得到的输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(&lt;class &apos;__main__.A&apos;&gt;, &lt;class &apos;__main__.B&apos;&gt;, &lt;class &apos;__main__.E&apos;&gt;, &lt;class &apos;__main__.C&apos;&gt;, &lt;class &apos;__main__.D&apos;&gt;, &lt;class &apos;__main__.F&apos;&gt;, &lt;type &apos;object&apos;&gt;)</div></pre></td></tr></table></figure>
<p>下面就是抽象出来的图</p>
<p><img src="/imgs/20190712/3.jpg" alt=""></p>
<p>我们就用拓扑排序来分析，但是这里会碰到同时存在好几个点都是入度为0 (说人话，就是没有被别人指向的点)，这时按照树的排序来，即从左到右，从根到叶，这里 A 就是根。<br>所以具体情况就是：我们先找到了点 A只有它没有被别人指向，输出A；去掉A及其伸出的两条线，剩 B 和 C 点同时满足只指向别人，按照树的顺序从左到右，故先输出B；去掉线剩 E 和 C ，输出E ;去线剩 C，输出C；去线剩 D 和 F ，输出D；去线只剩F ，输出F；最后输出object;得到的输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">A B E C D F object</div></pre></td></tr></table></figure>
<p>原文地址：<br><a href="https://www.jianshu.com/p/6651ed35104c" target="_blank" rel="external">https://www.jianshu.com/p/6651ed35104c</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fingerchou.com/2019/07/04/pycryptodome-usage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Finger Chou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Finger's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/04/pycryptodome-usage/" itemprop="url">使用PyCryptodome替代pyscrypto</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-04T07:11:00+08:00">
                2019-07-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/pycrypto/" itemprop="url" rel="index">
                    <span itemprop="name">pycrypto</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/04/pycryptodome-usage/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/07/04/pycryptodome-usage/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/07/04/pycryptodome-usage/" class="leancloud_visitors" data-flag-title="使用PyCryptodome替代pyscrypto">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>pycrypto 在Windows系统上安装比较麻烦，会出现意想不到的各种问题。因为pycrypto-2.6.1 之后就不在维护。因此系统兼容性就不那么友好。推荐PyCryptodome作为替代工具包。官方地址为：<a href="https://www.pycryptodome.org/en/latest/" target="_blank" rel="external">https://www.pycryptodome.org/en/latest/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 1、Windows pip install pycryptodomex</div><div class="line"># 2、Linux/Mac pip install pycryptodome</div></pre></td></tr></table></figure>
<p>举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">#!usr/bin/env python3</div><div class="line"># -*- coding:utf-8 _*-</div><div class="line"></div><div class="line">import base64</div><div class="line">import hashlib</div><div class="line">import json</div><div class="line">import platform</div><div class="line"></div><div class="line">if platform.system() != &apos;Windows&apos;:</div><div class="line">    from Crypto.Cipher import AES</div><div class="line">    from Crypto import Random</div><div class="line">else:</div><div class="line">    from Cryptodome.Cipher import AES</div><div class="line">    from Cryptodome import Random</div><div class="line">    </div><div class="line">class AESCipher(object):</div><div class="line">    def __init__(self, key):</div><div class="line">        self.bs = 32</div><div class="line">        self.key = hashlib.sha256(key.encode()).digest()</div><div class="line"></div><div class="line">    def encrypt(self, raw):</div><div class="line">        raw = self._pad(raw).encode(&apos;utf-8&apos;)</div><div class="line">        iv = Random.new().read(AES.block_size)</div><div class="line">        cipher = AES.new(self.key, AES.MODE_CBC, iv)</div><div class="line">        return base64.b64encode(iv + cipher.encrypt(raw))</div><div class="line"></div><div class="line">    def _pad(self, s):</div><div class="line">        return s + (self.bs - len(s) % self.bs) * chr(self.bs - len(s) % self.bs)</div><div class="line"></div><div class="line"></div><div class="line">def aes_encrypt(aes_key, app_client_id, app_client_secret):</div><div class="line">    aes = AESCipher(aes_key)</div><div class="line">    raw = dict(user=app_client_id, password=app_client_secret)</div><div class="line">    data = aes.encrypt(json.dumps(raw))</div><div class="line">    return bytes.decode(data)</div></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fingerchou.com/2019/03/23/flask-apscheduler-usage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Finger Chou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Finger's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/23/flask-apscheduler-usage/" itemprop="url">Flask-APScheduler 笔记</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-23T23:14:00+08:00">
                2019-03-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/03/23/flask-apscheduler-usage/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/03/23/flask-apscheduler-usage/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/03/23/flask-apscheduler-usage/" class="leancloud_visitors" data-flag-title="Flask-APScheduler 笔记">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Flask-APScheduler是Flask扩展，增加了对APScheduler的支持。</p>
<ul>
<li>支持从Flask配置加载调度程序配置以及任务定义。</li>
<li>支持WEB程序和调度程序共存。提供REST API管理任务调度。并为REST API提供身份验证。目前只支持Basic-Auth认证。</li>
</ul>
<p>官方地址：<a href="https://github.com/viniciuschiele/flask-apscheduler" target="_blank" rel="external">https://github.com/viniciuschiele/flask-apscheduler</a></p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">from flask import Flask</div><div class="line">from flask_apscheduler import APScheduler</div><div class="line"></div><div class="line"></div><div class="line">class Config(object):</div><div class="line">    JOBS = [</div><div class="line">        &#123;</div><div class="line">            &apos;id&apos;: &apos;job1&apos;,</div><div class="line">            &apos;func&apos;: &apos;jobs:job1&apos;,</div><div class="line">            &apos;args&apos;: (1, 2),</div><div class="line">            &apos;trigger&apos;: &apos;interval&apos;,</div><div class="line">            &apos;seconds&apos;: 10</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line"></div><div class="line">    SCHEDULER_API_ENABLED = True</div><div class="line"></div><div class="line"></div><div class="line">def job1(a, b):</div><div class="line">    print(str(a) + &apos; &apos; + str(b))</div><div class="line"></div><div class="line"></div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    app = Flask(__name__)</div><div class="line">    app.config.from_object(Config())</div><div class="line"></div><div class="line">    scheduler = APScheduler()</div><div class="line">    # it is also possible to enable the API directly</div><div class="line">    # scheduler.api_enabled = True</div><div class="line">    scheduler.init_app(app)</div><div class="line">    scheduler.start()</div><div class="line"></div><div class="line">    app.run()</div></pre></td></tr></table></figure>
<h3 id="Flask-Config-属性配置"><a href="#Flask-Config-属性配置" class="headerlink" title="Flask Config 属性配置"></a>Flask Config 属性配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">SCHEDULER_JOBSTORES         # 配置存储任务存储器</div><div class="line">SCHEDULER_EXECUTORS         # 配置执行器</div><div class="line">SCHEDULER_JOB_DEFAULTS      # 配置调度默认属性</div><div class="line">SCHEDULER_TIMEZONE          # 配置时区</div><div class="line">SCHEDULER_AUTH              # 配置认证中心</div><div class="line">SCHEDULER_API_ENABLED       # 配置是否开启API</div><div class="line">SCHEDULER_API_PREFIX        # 配置API路由前缀</div><div class="line">SCHEDULER_ENDPOINT_PREFIX   # 配置API路由后缀</div><div class="line">SCHEDULER_ALLOWED_HOSTS     # 配置访问白名单</div></pre></td></tr></table></figure>
<h3 id="REST-API-接口"><a href="#REST-API-接口" class="headerlink" title="REST API 接口"></a>REST API 接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&quot;&quot;&quot;</div><div class="line">Add the routes for the scheduler API.</div><div class="line">&quot;&quot;&quot;</div><div class="line">self._add_url_route(&apos;get_scheduler_info&apos;, &apos;&apos;, api.get_scheduler_info, &apos;GET&apos;)</div><div class="line">self._add_url_route(&apos;add_job&apos;, &apos;/jobs&apos;, api.add_job, &apos;POST&apos;)</div><div class="line">self._add_url_route(&apos;get_job&apos;, &apos;/jobs/&lt;job_id&gt;&apos;, api.get_job, &apos;GET&apos;)</div><div class="line">self._add_url_route(&apos;get_jobs&apos;, &apos;/jobs&apos;, api.get_jobs, &apos;GET&apos;)</div><div class="line">self._add_url_route(&apos;delete_job&apos;, &apos;/jobs/&lt;job_id&gt;&apos;, api.delete_job, &apos;DELETE&apos;)</div><div class="line">self._add_url_route(&apos;update_job&apos;, &apos;/jobs/&lt;job_id&gt;&apos;, api.update_job, &apos;PATCH&apos;)</div><div class="line">self._add_url_route(&apos;pause_job&apos;, &apos;/jobs/&lt;job_id&gt;/pause&apos;, api.pause_job, &apos;POST&apos;)</div><div class="line">self._add_url_route(&apos;resume_job&apos;, &apos;/jobs/&lt;job_id&gt;/resume&apos;, api.resume_job, &apos;POST&apos;)</div><div class="line">self._add_url_route(&apos;run_job&apos;, &apos;/jobs/&lt;job_id&gt;/run&apos;, api.run_job, &apos;POST&apos;)</div></pre></td></tr></table></figure>
<p>访问地址为：<a href="http://localhost:5000/scheduler/jobs" target="_blank" rel="external">http://localhost:5000/scheduler/jobs</a></p>
<p>如果配置了 <code>SCHEDULER_API_PREFIX = &quot;/api/v1/scheduler&quot;</code>，则访问地址为: <a href="http://localhost:5000/api/v1/scheduler/jobs" target="_blank" rel="external">http://localhost:5000/api/v1/scheduler/jobs</a></p>
<h3 id="配置API认证"><a href="#配置API认证" class="headerlink" title="配置API认证"></a>配置API认证</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SCHEDULER_AUTH = HTTPBasicAuth()</div><div class="line"></div><div class="line">@scheduler.authenticate</div><div class="line">def authenticate(auth):</div><div class="line">    return auth[&apos;username&apos;] == &apos;guest&apos; and auth[&apos;password&apos;] == &apos;guest&apos;</div></pre></td></tr></table></figure>
<p>完整示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">from flask import Flask</div><div class="line">from flask_apscheduler import APScheduler</div><div class="line">from flask_apscheduler.auth import HTTPBasicAuth</div><div class="line"></div><div class="line"></div><div class="line">class Config(object):</div><div class="line">    JOBS = [</div><div class="line">        &#123;</div><div class="line">            &apos;id&apos;: &apos;job1&apos;,</div><div class="line">            &apos;func&apos;: &apos;__main__:job1&apos;,</div><div class="line">            &apos;args&apos;: (1, 2),</div><div class="line">            &apos;trigger&apos;: &apos;interval&apos;,</div><div class="line">            &apos;seconds&apos;: 10</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line"></div><div class="line">    SCHEDULER_API_ENABLED = True</div><div class="line">    SCHEDULER_AUTH = HTTPBasicAuth()</div><div class="line"></div><div class="line"></div><div class="line">def job1(a, b):</div><div class="line">    print(str(a) + &apos; &apos; + str(b))</div><div class="line"></div><div class="line"></div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    app = Flask(__name__)</div><div class="line">    app.config.from_object(Config())</div><div class="line"></div><div class="line">    scheduler = APScheduler()</div><div class="line">    # it is also possible to set the authentication directly</div><div class="line">    # scheduler.auth = HTTPBasicAuth()</div><div class="line">    scheduler.init_app(app)</div><div class="line">    scheduler.start()</div><div class="line"></div><div class="line">    @scheduler.authenticate</div><div class="line">    def authenticate(auth):</div><div class="line">        return auth[&apos;username&apos;] == &apos;guest&apos; and auth[&apos;password&apos;] == &apos;guest&apos;</div><div class="line"></div><div class="line">    app.run()</div></pre></td></tr></table></figure>
<h3 id="使用过程遇到的问题"><a href="#使用过程遇到的问题" class="headerlink" title="使用过程遇到的问题"></a>使用过程遇到的问题</h3><h4 id="Debug启动过程中重复运行的问题"><a href="#Debug启动过程中重复运行的问题" class="headerlink" title="Debug启动过程中重复运行的问题"></a>Debug启动过程中重复运行的问题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># Bug: APScheduler in Flask executes twice</div><div class="line"># https://github.com/viniciuschiele/flask-apscheduler/issues/58</div><div class="line"></div><div class="line">app.run(debug=True, use_reloader=False)</div><div class="line"></div><div class="line"># or </div><div class="line"></div><div class="line">manager.add_command(&quot;runserver&quot;, Server(use_debugger=False, use_reloader=False))</div></pre></td></tr></table></figure>
<h4 id="多进程中APScheduler重复运行的问题"><a href="#多进程中APScheduler重复运行的问题" class="headerlink" title="多进程中APScheduler重复运行的问题"></a>多进程中APScheduler重复运行的问题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"># Fix Multiple instances of scheduler problem</div><div class="line"># https://github.com/viniciuschiele/flask-apscheduler/issues/51</div><div class="line">import platform</div><div class="line">import atexit</div><div class="line">if platform.system() != &apos;Windows&apos;:</div><div class="line">    fcntl = __import__(&quot;fcntl&quot;)</div><div class="line">    f = open(&quot;scheduler.lock&quot;, &quot;wb&quot;)</div><div class="line">    try:</div><div class="line">        fcntl.flock(f, fcntl.LOCK_EX | fcntl.LOCK_NB)</div><div class="line">        scheduler.start()</div><div class="line">        logger.debug(&quot;Scheduler Started...&quot;)</div><div class="line">    except Exception as e:</div><div class="line">        logger.error(&apos;Exit the scheduler, error - &#123;&#125;&apos;.format(e))</div><div class="line">        scheduler.shutdown()</div><div class="line"></div><div class="line">    def unlock():</div><div class="line">        fcntl.flock(f, fcntl.LOCK_UN)</div><div class="line">        f.close()</div><div class="line"></div><div class="line">    atexit.register(unlock)</div><div class="line">else:</div><div class="line">    msvcrt = __import__(&quot;msvcrt&quot;)</div><div class="line">    f = open(&quot;scheduler.lock&quot;, &quot;wb&quot;)</div><div class="line">    try:</div><div class="line">        msvcrt.locking(f.fileno(), msvcrt.LK_NBLCK, 1)</div><div class="line">        scheduler.start()</div><div class="line">        logger.debug(&quot;Scheduler Started...&quot;)</div><div class="line">    except Exception as e:</div><div class="line">        logger.error(&apos;Exit the scheduler, error - &#123;&#125;&apos;.format(e))</div><div class="line">        scheduler.shutdown()</div><div class="line"></div><div class="line">    def _unlock_file():</div><div class="line">        try:</div><div class="line">            f.seek(0)</div><div class="line">            msvcrt.locking(f.fileno(), msvcrt.LK_UNLCK, 1)</div><div class="line">        except IOError:</div><div class="line">            raise</div><div class="line">    atexit.register(_unlock_file)</div></pre></td></tr></table></figure>
<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>Flask-APScheduler缺少可视化任务调度和监控界面，需要使用者自己根据REST API扩展实现。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://stackoverflow.com/questions/25504149/why-does-running-the-flask-dev-server-run-itself-twice" target="_blank" rel="external">https://stackoverflow.com/questions/25504149/why-does-running-the-flask-dev-server-run-itself-twice</a></li>
<li><a href="https://blog.csdn.net/Raptor/article/details/69218271" target="_blank" rel="external">https://blog.csdn.net/Raptor/article/details/69218271</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fingerchou.com/2019/03/23/apscheduler-usage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Finger Chou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Finger's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/23/apscheduler-usage/" itemprop="url">APScheduler 笔记</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-23T14:13:00+08:00">
                2019-03-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/03/23/apscheduler-usage/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/03/23/apscheduler-usage/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/03/23/apscheduler-usage/" class="leancloud_visitors" data-flag-title="APScheduler 笔记">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p> APScheduler是类似Quartz的一个Python定时任务框架，实现了Quartz的所有功能，使用起来十分方便。提供了基于日期、固定时间间隔以及crontab类型的任务，并且可以持久化任务。如果将任务持久化到数据库中，那么它们也将在调度程序在重新启动后继续运行并保持其状态。重启启动调度程序后，它将运行它在脱机时运行的所有任务。</p>
<p> 除此之外，APScheduler还可以用作特定于平台的调度程序（如cron守护程序或Windows任务调度程序）的跨平台，特定于应用程序的替代程序。但请注意，APScheduler本身不是守护程序或服务，也不附带任何命令行工具。它主要用于在现有应用程序中运行。也就是说，APScheduler确实为我们提供了一些构建块来构建调度程序服务或运行专用的调度程序进程。</p>
<p> 官方地址：<a href="https://github.com/agronholm/apscheduler" target="_blank" rel="external">https://github.com/agronholm/apscheduler</a></p>
<p><img src="/imgs/20190323/APScheduler.png" alt=""></p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><h4 id="简单例子"><a href="#简单例子" class="headerlink" title="简单例子"></a>简单例子</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">#!usr/bin/env python3</div><div class="line"># -*- coding:utf-8 _*-</div><div class="line"></div><div class="line">from datetime import datetime</div><div class="line">import time</div><div class="line">import os</div><div class="line"></div><div class="line">from apscheduler.schedulers.background import BackgroundScheduler</div><div class="line"></div><div class="line"></div><div class="line">def tick():</div><div class="line">    print(&apos;Tick! The time is: %s&apos; % datetime.now())</div><div class="line"></div><div class="line"></div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    # 1、创建后台执行的 schedulers</div><div class="line">    scheduler = BackgroundScheduler()</div><div class="line">    # 2、添加调度任务，触发器选择 interval(间隔)，每隔3秒执行一次</div><div class="line">    scheduler.add_job(tick, &apos;interval&apos;, seconds=3)</div><div class="line">    # 3、启动调度任务</div><div class="line">    scheduler.start()</div><div class="line">    print(&apos;Press Ctrl+&#123;0&#125; to exit&apos;.format(&apos;Break&apos; if os.name == &apos;nt&apos; else &apos;C&apos;))</div><div class="line"></div><div class="line">    try:</div><div class="line">        # This is here to simulate application activity (which keeps the main thread alive).</div><div class="line">        while True:</div><div class="line">            time.sleep(2)</div><div class="line">    except (KeyboardInterrupt, SystemExit):</div><div class="line">        # Not strictly necessary if daemonic mode is enabled but should be done if possible</div><div class="line">        scheduler.shutdown()</div></pre></td></tr></table></figure>
<p><strong><code>jitter</code></strong>: 振动参数，给每次触发添加一个随机浮动秒数，一般适用于多服务器，避免同时运行造成服务拥堵。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 每小时（上下浮动120秒区间内）运行`tick`</div><div class="line">sched.add_job(tick, &apos;interval&apos;, hours=1, jitter=120)</div></pre></td></tr></table></figure></p>
<h4 id="自定义配置"><a href="#自定义配置" class="headerlink" title="自定义配置"></a>自定义配置</h4><p>方法一</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">#!usr/bin/env python3</div><div class="line"># -*- coding:utf-8 _*-</div><div class="line"></div><div class="line">from pytz import utc</div><div class="line">from datetime import datetime</div><div class="line">from apscheduler.schedulers.background import BackgroundScheduler</div><div class="line">from apscheduler.jobstores.mongodb import MongoDBJobStore</div><div class="line">from apscheduler.jobstores.sqlalchemy import SQLAlchemyJobStore</div><div class="line">from apscheduler.executors.pool import ThreadPoolExecutor, ProcessPoolExecutor</div><div class="line"></div><div class="line"></div><div class="line">def tick():</div><div class="line">    print(&apos;Tick! The time is: %s&apos; % datetime.now())</div><div class="line"></div><div class="line"></div><div class="line"># 选择MongoDB作为任务存储数据库</div><div class="line">jobstores = &#123;</div><div class="line">    &apos;mongo&apos;: MongoDBJobStore(),</div><div class="line">    &apos;default&apos;: SQLAlchemyJobStore(url=&apos;sqlite:///jobs.sqlite&apos;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"># 默认使用线程池</div><div class="line">executors = &#123;</div><div class="line">    &apos;default&apos;: ThreadPoolExecutor(20),</div><div class="line">    &apos;processpool&apos;: ProcessPoolExecutor(5)</div><div class="line">&#125;</div><div class="line"></div><div class="line"># 默认参数配置</div><div class="line">job_defaults = &#123;</div><div class="line">    &apos;coalesce&apos;: False,  # 积攒的任务是否只跑一次，是否合并所有错过的Job</div><div class="line">    &apos;max_instances&apos;: 3,  # 默认同一时刻只能有一个实例运行，通过max_instances=3修改为3个。</div><div class="line">    &apos;misfire_grace_time&apos;: 30  # 30秒的任务超时容错</div><div class="line">&#125;</div><div class="line"></div><div class="line">scheduler = BackgroundScheduler(jobstores=jobstores, executors=executors, job_defaults=job_defaults, timezone=utc)</div><div class="line">scheduler.add_job(tick, &apos;interval&apos;, seconds=3)</div><div class="line">scheduler.start()</div></pre></td></tr></table></figure>
<p>方法二</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">from apscheduler.schedulers.background import BackgroundScheduler</div><div class="line"></div><div class="line"></div><div class="line"># The &quot;apscheduler.&quot; prefix is hard coded</div><div class="line">scheduler = BackgroundScheduler(&#123;</div><div class="line">    &apos;apscheduler.jobstores.mongo&apos;: &#123;</div><div class="line">         &apos;type&apos;: &apos;mongodb&apos;</div><div class="line">    &#125;,</div><div class="line">    &apos;apscheduler.jobstores.default&apos;: &#123;</div><div class="line">        &apos;type&apos;: &apos;sqlalchemy&apos;,</div><div class="line">        &apos;url&apos;: &apos;sqlite:///jobs.sqlite&apos;</div><div class="line">    &#125;,</div><div class="line">    &apos;apscheduler.executors.default&apos;: &#123;</div><div class="line">        &apos;class&apos;: &apos;apscheduler.executors.pool:ThreadPoolExecutor&apos;,</div><div class="line">        &apos;max_workers&apos;: &apos;20&apos;</div><div class="line">    &#125;,</div><div class="line">    &apos;apscheduler.executors.processpool&apos;: &#123;</div><div class="line">        &apos;type&apos;: &apos;processpool&apos;,</div><div class="line">        &apos;max_workers&apos;: &apos;5&apos;</div><div class="line">    &#125;,</div><div class="line">    &apos;apscheduler.job_defaults.coalesce&apos;: &apos;false&apos;,</div><div class="line">    &apos;apscheduler.job_defaults.max_instances&apos;: &apos;3&apos;,</div><div class="line">    &apos;apscheduler.timezone&apos;: &apos;UTC&apos;,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>方法三<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">from pytz import utc</div><div class="line"></div><div class="line">from apscheduler.schedulers.background import BackgroundScheduler</div><div class="line">from apscheduler.jobstores.sqlalchemy import SQLAlchemyJobStore</div><div class="line">from apscheduler.executors.pool import ProcessPoolExecutor</div><div class="line"></div><div class="line"></div><div class="line">jobstores = &#123;</div><div class="line">    &apos;mongo&apos;: &#123;&apos;type&apos;: &apos;mongodb&apos;&#125;,</div><div class="line">    &apos;default&apos;: SQLAlchemyJobStore(url=&apos;sqlite:///jobs.sqlite&apos;)</div><div class="line">&#125;</div><div class="line">executors = &#123;</div><div class="line">    &apos;default&apos;: &#123;&apos;type&apos;: &apos;threadpool&apos;, &apos;max_workers&apos;: 20&#125;,</div><div class="line">    &apos;processpool&apos;: ProcessPoolExecutor(max_workers=5)</div><div class="line">&#125;</div><div class="line">job_defaults = &#123;</div><div class="line">    &apos;coalesce&apos;: False,</div><div class="line">    &apos;max_instances&apos;: 3</div><div class="line">&#125;</div><div class="line">scheduler = BackgroundScheduler()</div><div class="line"></div><div class="line"># ..这里可以添加任务</div><div class="line"></div><div class="line">scheduler.configure(jobstores=jobstores, executors=executors, job_defaults=job_defaults, timezone=utc)</div></pre></td></tr></table></figure></p>
<p><strong><code>misfire_grace_time</code></strong>：如果一个job本来14:00有一次执行，但是由于某种原因没有被调度上，现在14:01了，这个14:00的运行实例被提交时，会检查它预订运行的时间和当下时间的差值（这里是1分钟），大于我们设置的30秒限制，那么这个运行实例不会被执行。<br>合并：最常见的情形是scheduler被shutdown后重启，某个任务会积攒了好几次没执行如5次，下次这个job被submit给executor时，执行5次。将coalesce=True后，只会执行一次</p>
<p><strong><code>replace_existing</code></strong>: 如果在程序初始化时，是从数据库读取任务的，那么必须为每个任务定义一个明确的ID，并且使用replace_existing=True，否则每次重启程序，你都会得到一份新的任务拷贝，也就意味着任务的状态不会保存。</p>
<h4 id="调度器的操作"><a href="#调度器的操作" class="headerlink" title="调度器的操作"></a>调度器的操作</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">scheduler.add_job()         </div><div class="line">scheduler.modify_job()      </div><div class="line">scheduler.remove_job()</div><div class="line">scheduler.pause_job()</div><div class="line">scheduler.resume_job()</div><div class="line">scheduler.reschedule_job()</div><div class="line">scheduler.start()</div><div class="line">scheduler.shutdown()</div><div class="line"></div><div class="line">scheduler.get_jobs()</div><div class="line">scheduler.remove_all_jobs()</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">添加job，所需要的属性</div><div class="line">add_job(func, trigger=None, args=None, kwargs=None, id=None, name=None,</div><div class="line">                misfire_grace_time=undefined, coalesce=undefined, max_instances=undefined,</div><div class="line">                next_run_time=undefined, jobstore=&apos;default&apos;, executor=&apos;default&apos;,</div><div class="line">                replace_existing=False, **trigger_args):</div><div class="line"></div><div class="line"></div><div class="line">job_kwargs = &#123;</div><div class="line">    &apos;trigger&apos;: self._create_trigger(trigger, trigger_args),</div><div class="line">    &apos;executor&apos;: executor,</div><div class="line">    &apos;func&apos;: func,</div><div class="line">    &apos;args&apos;: tuple(args) if args is not None else (),</div><div class="line">    &apos;kwargs&apos;: dict(kwargs) if kwargs is not None else &#123;&#125;,</div><div class="line">    &apos;id&apos;: id,</div><div class="line">    &apos;name&apos;: name,</div><div class="line">    &apos;misfire_grace_time&apos;: misfire_grace_time,</div><div class="line">    &apos;coalesce&apos;: coalesce,</div><div class="line">    &apos;max_instances&apos;: max_instances,</div><div class="line">    &apos;next_run_time&apos;: next_run_time</div><div class="line">&#125;</div><div class="line">job_kwargs = dict((key, value) for key, value in six.iteritems(job_kwargs) if</div><div class="line">                  value is not undefined)</div><div class="line">job = Job(self, **job_kwargs)</div></pre></td></tr></table></figure>
<h4 id="调度监听"><a href="#调度监听" class="headerlink" title="调度监听"></a>调度监听</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">def my_listener(event):</div><div class="line">    if event.exception:</div><div class="line">        print(&apos;The job() crashed :(&apos;.format(event.job_id))  # or logger.fatal(&apos;The job crashed :(&apos;)</div><div class="line">    else:</div><div class="line">        print(&apos;The job() worked :)&apos;.format(event.job_id))</div><div class="line"></div><div class="line">scheduler.add_listener(my_listener, EVENT_JOB_EXECUTED | EVENT_JOB_ERROR)</div></pre></td></tr></table></figure>
<h4 id="夏令时问题"><a href="#夏令时问题" class="headerlink" title="夏令时问题"></a>夏令时问题</h4><p>有些<code>timezone</code>时区可能会有夏令时的问题。这个可能导致令时切换时，任务不执行或任务执行两次。避免这个问题，可以使用UTC时间，或提前预知并规划好执行的问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 在Europe/Helsinki时区, 在三月最后一个周一就不会触发；在十月最后一个周一会触发两次</div><div class="line">sched.add_job(job_function, &apos;cron&apos;, hour=3, minute=30)</div></pre></td></tr></table></figure>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://github.com/agronholm/apscheduler" target="_blank" rel="external">https://github.com/agronholm/apscheduler</a></li>
<li><a href="https://www.jianshu.com/p/4f5305e220f0" target="_blank" rel="external">https://www.jianshu.com/p/4f5305e220f0</a></li>
<li><a href="https://www.jianshu.com/p/4f5305e220f0" target="_blank" rel="external">https://www.jianshu.com/p/4f5305e220f0</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fingerchou.com/2018/09/15/aws-serverless-with-nodejs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Finger Chou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Finger's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/15/aws-serverless-with-nodejs/" itemprop="url">AWS Serverless - NodeJs实践</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-15T11:37:00+08:00">
                2018-09-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NodeJs/" itemprop="url" rel="index">
                    <span itemprop="name">NodeJs</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/15/aws-serverless-with-nodejs/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/15/aws-serverless-with-nodejs/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/09/15/aws-serverless-with-nodejs/" class="leancloud_visitors" data-flag-title="AWS Serverless - NodeJs实践">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一、Serverless简介"><a href="#一、Serverless简介" class="headerlink" title="一、Serverless简介"></a>一、Serverless简介</h3><p>Serverless是一种无服务的架构，如AWS Lambda。Serverless与传统架构不同，由开发者实现的服务端逻辑运行在无状态的计算容器中，它是由事件触发，短暂的(可能只存在于一次请求过程中)，完全被第三方管理。</p>
<p>以亚马逊的AWS Lambda为案例，Lambda能让不用思考任何服务器，也就是说，不用你处理服务器上的部署、服务器容量和服务器的扩展和失败容错，还有服务器上选择什么OS操作系统，语言的更新，日志等等问题。你的应用程序只需要和多个第三方的API或服务打交道，也可以自我创建一个无服务器的API。</p>
<h3 id="二、Amazon-API-Gateway"><a href="#二、Amazon-API-Gateway" class="headerlink" title="二、Amazon API Gateway"></a>二、Amazon API Gateway</h3><p>Amazon API Gateway 是一种完全托管的服务，可以帮助开发者轻松创建、发布、维护、监控和保护任意规模的 API。只需在 AWS 管理控制台中点击几下，您便可以创建可充当应用程序“前门”的 API，从后端服务访问数据、业务逻辑或功能，例如基于 Amazon Elastic Compute Cloud (Amazon EC2) 运行的工作负载、基于 AWS Lambda 运行的代码或任意 Web 应用。</p>
<p>Amazon API Gateway 负责管理所有任务，涉及接受和处理成千上万个并发 API 调用，包括流量管理、授权和访问控制、监控，以及 API 版本管理。Amazon API Gateway 没有最低费用和启动成本。您只需为收到的 API 调用以及传出的数据量付费。</p>
<h3 id="三、使用NodeJs创建Serverless-API"><a href="#三、使用NodeJs创建Serverless-API" class="headerlink" title="三、使用NodeJs创建Serverless API"></a>三、使用NodeJs创建Serverless API</h3><h4 id="aws-serverless-express-——-基于Express的Serverless中间件"><a href="#aws-serverless-express-——-基于Express的Serverless中间件" class="headerlink" title="aws-serverless-express —— 基于Express的Serverless中间件"></a>aws-serverless-express —— 基于Express的Serverless中间件</h4><p><a href="https://github.com/fingerchou/aws-serverless-express" target="_blank" rel="external">https://github.com/fingerchou/aws-serverless-express</a></p>
<p>Run serverless applications and REST APIs using your existing Node.js application framework, on top of AWS Lambda and Amazon API Gateway. The sample provided allows you to easily build serverless web applications/services and RESTful APIs using the Express framework.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">// lambda.js</div><div class="line"></div><div class="line">&apos;use strict&apos;;</div><div class="line">const awsServerlessExpress = require(&apos;aws-serverless-express&apos;);</div><div class="line">const app = require(&apos;./app&apos;);</div><div class="line"></div><div class="line">// NOTE: If you get ERR_CONTENT_DECODING_FAILED in your browser, this is likely</div><div class="line">// due to a compressed response (e.g. gzip) which has not been handled correctly</div><div class="line">// by aws-serverless-express and/or API Gateway. Add the necessary MIME types to</div><div class="line">// binaryMimeTypes below, then redeploy (`npm run package-deploy`)</div><div class="line"></div><div class="line">const binaryMimeTypes = [</div><div class="line">  &apos;application/javascript&apos;,</div><div class="line">  &apos;application/json&apos;,</div><div class="line">  &apos;application/octet-stream&apos;,</div><div class="line">  &apos;application/xml&apos;,</div><div class="line">  &apos;font/eot&apos;,</div><div class="line">  &apos;font/opentype&apos;,</div><div class="line">  &apos;font/otf&apos;,</div><div class="line">  &apos;image/jpeg&apos;,</div><div class="line">  &apos;image/png&apos;,</div><div class="line">  &apos;image/svg+xml&apos;,</div><div class="line">  &apos;text/comma-separated-values&apos;,</div><div class="line">  &apos;text/css&apos;,</div><div class="line">  &apos;text/html&apos;,</div><div class="line">  &apos;text/javascript&apos;,</div><div class="line">  &apos;text/plain&apos;,</div><div class="line">  &apos;text/text&apos;,</div><div class="line">  &apos;text/xml&apos;</div><div class="line">];</div><div class="line"></div><div class="line">const server = awsServerlessExpress.createServer(app, null, binaryMimeTypes);</div><div class="line"></div><div class="line">exports.handler = (event, context) =&gt; awsServerlessExpress.proxy(server, event, context);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line">// app.js</div><div class="line"></div><div class="line">&apos;use strict&apos;;</div><div class="line"></div><div class="line">const express = require(&apos;express&apos;);</div><div class="line">const bodyParser = require(&apos;body-parser&apos;);</div><div class="line">const cors = require(&apos;cors&apos;);</div><div class="line">const compression = require(&apos;compression&apos;);</div><div class="line">const awsServerlessExpressMiddleware = require(&apos;aws-serverless-express/middleware&apos;); </div><div class="line">const app = express();</div><div class="line">const router = express.Router();</div><div class="line"></div><div class="line">// gzip compression</div><div class="line">app.use(compression());</div><div class="line"></div><div class="line">// enable CORS - Cross Origin Resource Sharing</div><div class="line">app.use(cors());</div><div class="line">app.use(bodyParser.json());</div><div class="line">app.use(bodyParser.urlencoded(&#123; extended: true &#125;));</div><div class="line">app.use(awsServerlessExpressMiddleware.eventContext());</div><div class="line"></div><div class="line">router.get(&apos;/hello&apos;, (req, res) =&gt; &#123;</div><div class="line">    res.json(&#123;&quot;say&quot;: &quot;Hello World&quot;&#125;)</div><div class="line">&#125;);</div><div class="line"></div><div class="line">router.get(&apos;/users&apos;, (req, res) =&gt; &#123;</div><div class="line">    res.json(users);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">router.get(&apos;/users/:userId&apos;, (req, res) =&gt; &#123;</div><div class="line">    const user = getUser(req.params.userId);</div><div class="line">    if(!user) &#123;</div><div class="line">        return res.status(404).json(&#123;&#125;);</div><div class="line">    &#125;</div><div class="line">    return res.json(user);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">router.post(&apos;/users&apos;, (req, res) =&gt; &#123;</div><div class="line">    const user = &#123;</div><div class="line">        id: ++userIdCounter,</div><div class="line">        name: req.body.name</div><div class="line">    &#125;;</div><div class="line">    users.push(user);</div><div class="line">    res.status(201).json(user);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">router.put(&apos;/users/:userId&apos;, (req, res) =&gt; &#123;</div><div class="line">    const user = getUser(req.params.userId);</div><div class="line">    console.log(req.params.userId, user);</div><div class="line">    if (!user) &#123;</div><div class="line">        return res.status(404).json(&#123;&#125;);</div><div class="line">    &#125;</div><div class="line">    user.name = req.body.name;</div><div class="line">    res.json(user);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">router.delete(&apos;/users/:userId&apos;, (req, res) =&gt; &#123;</div><div class="line">    const userIndex = getUserIndex(req.params.userId);</div><div class="line">    if (userIndex === -1) &#123;</div><div class="line">        return res.status(404).json(&#123;&#125;);</div><div class="line">    &#125;</div><div class="line">    users.splice(userIndex, 1);</div><div class="line">    res.json(users);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">const users = [&#123;</div><div class="line">    id: 1,</div><div class="line">    name: &apos;Joe&apos;</div><div class="line">&#125;, &#123;</div><div class="line">    id: 2,</div><div class="line">    name: &apos;Jame&apos;</div><div class="line">&#125;];</div><div class="line"></div><div class="line">let userIdCounter = users.length;</div><div class="line"></div><div class="line">const getUser = (userId) =&gt; users.find(u =&gt; u.id === parseInt(userId));</div><div class="line">const getUserIndex = (userId) =&gt; users.findIndex(u =&gt; u.id === parseInt(userId));</div><div class="line"></div><div class="line">app.use(&apos;/&apos;, router);</div><div class="line"></div><div class="line">module.exports = app;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// app.local.js</div><div class="line"></div><div class="line">const app = require(&apos;./app&apos;);</div><div class="line">const port = 5000;</div><div class="line"></div><div class="line">app.listen(port);</div><div class="line">console.log(`listening on http://localhost:$&#123;port&#125;`);</div></pre></td></tr></table></figure>
<h4 id="Apex-——-发布程序到AWS-Lambda"><a href="#Apex-——-发布程序到AWS-Lambda" class="headerlink" title="Apex —— 发布程序到AWS Lambda"></a>Apex —— 发布程序到AWS Lambda</h4><p><a href="http://apex.run/" target="_blank" rel="external">http://apex.run/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">// project.development.json</div><div class="line"></div><div class="line">&#123;</div><div class="line">  &quot;name&quot;: &quot;finger_demo&quot;,</div><div class="line">  &quot;description&quot;: &quot;this is finger demo&quot;,</div><div class="line">  &quot;memory&quot;: 128,</div><div class="line">  &quot;timeout&quot;: 300,</div><div class="line">  &quot;role&quot;: &quot;xxx&quot;,</div><div class="line">  &quot;handler&quot;: &quot;lambda.handler&quot;,</div><div class="line">  &quot;runtime&quot;: &quot;nodejs8.10&quot;,</div><div class="line">  &quot;region&quot;: &quot;us-east-1&quot;,</div><div class="line">  &quot;retainedVersions&quot;: 5,</div><div class="line">  &quot;hooks&quot;: &#123;</div><div class="line">    &quot;build&quot;: &quot;npm install&quot;</div><div class="line">  &#125;,</div><div class="line">  &quot;environment&quot;: &#123;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 发布development环境</div><div class="line">apex deploy -e development</div><div class="line"></div><div class="line">// 使用development别名</div><div class="line">apex alias development</div></pre></td></tr></table></figure>
<h3 id="四、创建AWS-API-Gateway测试"><a href="#四、创建AWS-API-Gateway测试" class="headerlink" title="四、创建AWS API-Gateway测试"></a>四、创建AWS API-Gateway测试</h3><h4 id="新建API-Gateway，创建Proxy"><a href="#新建API-Gateway，创建Proxy" class="headerlink" title="新建API-Gateway，创建Proxy"></a>新建API-Gateway，创建Proxy</h4><p><img src="/imgs/20180915/20180915114350.png" alt=""></p>
<h4 id="proxy指向Lambda"><a href="#proxy指向Lambda" class="headerlink" title="proxy指向Lambda"></a>proxy指向Lambda</h4><p><img src="/imgs/20180915/20180915114509.png" alt=""></p>
<h4 id="发布API，别名为development"><a href="#发布API，别名为development" class="headerlink" title="发布API，别名为development"></a>发布API，别名为development</h4><p><img src="/imgs/20180915/20180915114615.png" alt=""></p>
<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p><img src="/imgs/20180915/20180915114718.png" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fingerchou.com/2018/08/24/pandas-basis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Finger Chou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Finger's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/24/pandas-basis/" itemprop="url">Pandas基础</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-24T22:19:00+08:00">
                2018-08-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/24/pandas-basis/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/24/pandas-basis/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/08/24/pandas-basis/" class="leancloud_visitors" data-flag-title="Pandas基础">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文地址：<a href="https://www.jiqizhixin.com/articles/2018-07-18-3" target="_blank" rel="external">https://www.jiqizhixin.com/articles/2018-07-18-3</a></p>
<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>Pandas是基于Numpy构建的库，在数据处理方面可以把它理解为numpy加强版。不同于numpy的是，pandas拥有种数据结构：<strong>Series和DataFrame</strong>：</p>
<p><img src="/imgs/20180824/pandas-series.jpg" alt=""></p>
<p>用代码生成一个简单的Series对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; from pandas import Series, DataFrame</div><div class="line">&gt;&gt;&gt; import pandas as pd</div><div class="line">&gt;&gt;&gt; data = Series([1,2,3,4],index = [&apos;a&apos;,&apos;b&apos;,&apos;c&apos;,&apos;d&apos;])</div><div class="line">&gt;&gt;&gt; data</div><div class="line">a    1</div><div class="line">b    2</div><div class="line">c    3</div><div class="line">d    4</div><div class="line">dtype: int64</div></pre></td></tr></table></figure>
<p>Series是一种类似一维数组的数据结构，由一组数据和与之相关的index组成，这个结构一看似乎与dict字典差不多，我们知道字典是一种无序的数据结构，而pandas中的Series的数据结构不一样，它相当于定长有序的字典，并且它的index和value之间是独立的，两者的索引还是有区别的，Series的index是可变的，而dict字典的key值是不可变的。</p>
<p><img src="/imgs/20180824/pandas-dataframe.jpg" alt=""></p>
<p>用代码生成一个简单的DataFrame对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; data = &#123;&apos;a&apos;:[1,2,3],&apos;b&apos;:[&apos;we&apos;,&apos;you&apos;,&apos;they&apos;],&apos;c&apos;:[&apos;btc&apos;,&apos;eos&apos;,&apos;ae&apos;]&#125;</div><div class="line">&gt;&gt;&gt; df = DataFrame(data)</div><div class="line">&gt;&gt;&gt; df</div><div class="line">   a     b    c</div><div class="line">0  1    we  btc</div><div class="line">1  2   you  eos</div><div class="line">2  3  they   ae</div></pre></td></tr></table></figure>
<p>DataFrame这种数据结构我们可以把它看作是一张二维表，DataFrame长得跟我们平时使用的Excel表格差不多，DataFrame的横行称为columns，竖列和Series一样称为index，DataFrame每一列可以是不同类型的值集合，所以DataFrame你也可以把它视为不同数据类型同一index的Series集合。</p>
<h4 id="Series"><a href="#Series" class="headerlink" title="Series"></a>Series</h4><h5 id="Series的两种生成方式"><a href="#Series的两种生成方式" class="headerlink" title="Series的两种生成方式"></a>Series的两种生成方式</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; data = Series([222,&apos;btc&apos;,234,&apos;eos&apos;])</div><div class="line">&gt;&gt;&gt; data</div><div class="line">0    222</div><div class="line">1    btc</div><div class="line">2    234</div><div class="line">3    eos</div><div class="line">dtype: object</div></pre></td></tr></table></figure>
<p>虽然我们在生成的时候没有设置index值，但Series还是会自动帮我们生成index，这种方式生成的Series结构跟list列表差不多，可以把这种形式的Series理解为竖起来的list列表。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; data = Series([1,2,3,4],index = [&apos;a&apos;,&apos;b&apos;,&apos;c&apos;,&apos;d&apos;])</div><div class="line">&gt;&gt;&gt; data</div><div class="line">a    1</div><div class="line">b    2</div><div class="line">c    3</div><div class="line">d    4</div><div class="line">dtype: int64</div></pre></td></tr></table></figure>
<p>这种形式的Series可以理解为numpy的array外面披了一件index的马甲，所以array的相关操作，Series同样也是支持的。结构非常相似的dict字典同样也是可以转化为Series格式的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; dic = &#123;&apos;a&apos;:1,&apos;b&apos;:2,&apos;c&apos;:&apos;as&apos;&#125;</div><div class="line">&gt;&gt;&gt; dicSeries = Series(dic)</div><div class="line">&gt;&gt;&gt; dicSeries</div><div class="line">a     1</div><div class="line">b     2</div><div class="line">c    as</div><div class="line">dtype: object</div></pre></td></tr></table></figure></p>
<h5 id="查看Series的相关信息"><a href="#查看Series的相关信息" class="headerlink" title="查看Series的相关信息"></a>查看Series的相关信息</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; data.index</div><div class="line">Index([&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;], dtype=&apos;object&apos;)</div><div class="line">&gt;&gt;&gt; data.values</div><div class="line">array([1, 2, 3, 4], dtype=int64)</div><div class="line"># in方法默认判断的是index值</div><div class="line">&gt;&gt;&gt; &apos;a&apos; in data</div><div class="line">True</div></pre></td></tr></table></figure>
<h5 id="Series的NaN生成"><a href="#Series的NaN生成" class="headerlink" title="Series的NaN生成"></a>Series的NaN生成</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; index1 = [ &apos;a&apos;,&apos;b&apos;,&apos;c&apos;,&apos;d&apos;]</div><div class="line">&gt;&gt;&gt; dic = &#123;&apos;b&apos;:1,&apos;c&apos;:1,&apos;d&apos;:1&#125;</div><div class="line">&gt;&gt;&gt; data2 = Series(dic,index=index1)</div><div class="line">&gt;&gt;&gt; data2</div><div class="line">a    NaN</div><div class="line">b    1.0</div><div class="line">c    1.0</div><div class="line">d    1.0</div><div class="line">dtype: float64</div></pre></td></tr></table></figure>
<p>从这里我们可以看出Series的生成依据的是index值，index‘a’在字典dic的key中并不存在，Series自然也找不到’a’的对应value值，这种情况下Pandas就会自动生成NaN(not a number)来填补缺失值，这里还有个有趣的现象，原本dtype是int类型，生成NaN后就变成了float类型了，因为NaN的官方定义就是float类型。</p>
<h5 id="NaN的相关查询"><a href="#NaN的相关查询" class="headerlink" title="NaN的相关查询"></a>NaN的相关查询</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; data2.isnull()</div><div class="line">a     True</div><div class="line">b    False</div><div class="line">c    False</div><div class="line">d    False</div><div class="line">dtype: bool</div><div class="line">&gt;&gt;&gt; data2.notnull()</div><div class="line">a    False</div><div class="line">b     True</div><div class="line">c     True</div><div class="line">d     True</div><div class="line">dtype: bool</div><div class="line"></div><div class="line"># 嵌套查询NaN</div><div class="line">&gt;&gt;&gt; data2[data2.isnull()==True]</div><div class="line">a   NaN</div><div class="line">dtype: float64</div><div class="line"></div><div class="line"># 统计非NaN个数</div><div class="line">&gt;&gt;&gt; data2.count()</div><div class="line">3</div></pre></td></tr></table></figure>
<p>切记切记，查询NaN值切记不要使用np.nan==np.nan这种形式来作为判断条件，结果永远是False，==是用作值判断的，而NaN并没有值，如果你不想使用上方的判断方法，你可以使用is作为判断方法，is是对象引用判断，np.nan is np.nan，结果就是你要的True。</p>
<h5 id="Series的name属性"><a href="#Series的name属性" class="headerlink" title="Series的name属性"></a>Series的name属性</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; data.index.name = &apos;abc&apos;</div><div class="line">&gt;&gt;&gt; data.name = &apos;test&apos;</div><div class="line">&gt;&gt;&gt; data</div><div class="line">abc</div><div class="line">a    1</div><div class="line">b    2</div><div class="line">c    3</div><div class="line">d    4</div><div class="line">Name: test, dtype: int64</div></pre></td></tr></table></figure>
<p>Series对象本身及其索引index都有一个name属性，name属性主要发挥作用是在DataFrame中，当我们把一个Series对象放进DataFrame中，新的列将根据我们的name属性对该列进行命名，如果我们没有给Series命名，DataFrame则会自动帮我们命名为0。</p>
<h4 id="DataFrame"><a href="#DataFrame" class="headerlink" title="DataFrame"></a>DataFrame</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; data = &#123;&apos;name&apos;: [&apos;BTC&apos;, &apos;ETH&apos;, &apos;EOS&apos;], &apos;price&apos;:[50000, 4000, 150]&#125;</div><div class="line">&gt;&gt;&gt; data = DataFrame(data)</div><div class="line">&gt;&gt;&gt; data</div><div class="line">  name  price</div><div class="line">0  BTC  50000</div><div class="line">1  ETH   4000</div><div class="line">2  EOS    150</div></pre></td></tr></table></figure>
<p>DataFrame的生成与Series差不多，你可以自己指定index，也可不指定，DataFrame会自动帮你补上。</p>
<h5 id="查看DataFrame的相关信息"><a href="#查看DataFrame的相关信息" class="headerlink" title="查看DataFrame的相关信息"></a>查看DataFrame的相关信息</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; data.index</div><div class="line">RangeIndex(start=0, stop=3, step=1)</div><div class="line">&gt;&gt;&gt; data.values</div><div class="line">array([[&apos;BTC&apos;, 50000],</div><div class="line">       [&apos;ETH&apos;, 4000],</div><div class="line">       [&apos;EOS&apos;, 150]], dtype=object)</div><div class="line">&gt;&gt;&gt; data.columns</div><div class="line">Index([&apos;name&apos;, &apos;price&apos;], dtype=&apos;object&apos;)</div></pre></td></tr></table></figure>
<h5 id="DataFrame索引"><a href="#DataFrame索引" class="headerlink" title="DataFrame索引"></a>DataFrame索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; data.name</div><div class="line">0    BTC</div><div class="line">1    ETH</div><div class="line">2    EOS</div><div class="line">Name: name, dtype: object</div><div class="line"></div><div class="line">&gt;&gt;&gt; data[&apos;name&apos;]</div><div class="line">0    BTC</div><div class="line">1    ETH</div><div class="line">2    EOS</div><div class="line">Name: name, dtype: object</div><div class="line"></div><div class="line"># loc[&apos;name&apos;]查询的是行标签</div><div class="line">&gt;&gt;&gt; data.iloc[1]</div><div class="line">name      ETH</div><div class="line">price    4000</div><div class="line">Name: 1, dtype: object</div></pre></td></tr></table></figure>
<p>其实行索引，除了iloc，loc还有个ix，ix既可以进行行标签索引，也可以进行行号索引，但这也大大增加了它的不确定性，有时会出现一些奇怪的问题，所以pandas在0.20.0版本的时候就把ix给弃用了。</p>
<h5 id="DataFrame的常用操作"><a href="#DataFrame的常用操作" class="headerlink" title="DataFrame的常用操作"></a>DataFrame的常用操作</h5><h6 id="简单地增加行、列"><a href="#简单地增加行、列" class="headerlink" title="简单地增加行、列"></a>简单地增加行、列</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; data[&apos;type&apos;] = &apos;token&apos;</div><div class="line">&gt;&gt;&gt; data</div><div class="line">  name  price   type</div><div class="line">0  BTC  50000  token</div><div class="line">1  ETH   4000  token</div><div class="line">2  EOS    150  token</div><div class="line"></div><div class="line">&gt;&gt;&gt; data.loc[&apos;3&apos;] = [&apos;ae&apos;,200,&apos;token&apos;]</div><div class="line">&gt;&gt;&gt; data</div><div class="line">  name  price   type</div><div class="line">0  BTC  50000  token</div><div class="line">1  ETH   4000  token</div><div class="line">2  EOS    150  token</div><div class="line">3   ae    200  token</div></pre></td></tr></table></figure>
<h6 id="删除行、列操作"><a href="#删除行、列操作" class="headerlink" title="删除行、列操作"></a>删除行、列操作</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; del data[&apos;type&apos;]</div><div class="line">&gt;&gt;&gt; data</div><div class="line">  name  price</div><div class="line">0  BTC  50000</div><div class="line">1  ETH   4000</div><div class="line">2  EOS    150</div><div class="line">3   ae    200</div><div class="line"></div><div class="line">&gt;&gt;&gt; data.drop([2])</div><div class="line">  name  price</div><div class="line">0  BTC  50000</div><div class="line">1  ETH   4000</div><div class="line">3   ae    200</div><div class="line"></div><div class="line">&gt;&gt;&gt; data</div><div class="line">  name  price</div><div class="line">0  BTC  50000</div><div class="line">1  ETH   4000</div><div class="line">2  EOS    150</div><div class="line">3   ae    200</div></pre></td></tr></table></figure>
<p>这里需要注意的是，使用drop（）方法返回的是Copy而不是视图，要想真正在原数据里删除行，就要设置inplace=True<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; data.drop([2],inplace=True)</div><div class="line">&gt;&gt;&gt; data</div><div class="line">  name  price</div><div class="line">0  BTC  50000</div><div class="line">1  ETH   4000</div><div class="line">3   ae    200</div></pre></td></tr></table></figure></p>
<h6 id="设置某一列为index"><a href="#设置某一列为index" class="headerlink" title="设置某一列为index"></a>设置某一列为index</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; data.set_index([&apos;name&apos;],inplace=True)</div><div class="line">&gt;&gt;&gt; data</div><div class="line">      price</div><div class="line">name</div><div class="line">BTC   50000</div><div class="line">ETH    4000</div><div class="line">ae      200</div><div class="line"></div><div class="line"># 将index返回回dataframe中</div><div class="line">&gt;&gt;&gt; data.reset_index(inplace=True)</div><div class="line">&gt;&gt;&gt; data</div><div class="line">  name  price</div><div class="line">0  BTC  50000</div><div class="line">1  ETH   4000</div><div class="line">2   ae    200</div></pre></td></tr></table></figure>
<h6 id="处理缺失值"><a href="#处理缺失值" class="headerlink" title="处理缺失值"></a>处理缺失值</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data.dropna()    # 丢弃含有缺失值的行</div><div class="line">data.fillna(0)    # 填充缺失值数据为0</div></pre></td></tr></table></figure>
<p>还是需要注意：这些方法返回的是copy而不是视图，如果想在原数据上改变，别忘了inplace=True。</p>
<h6 id="数据合并"><a href="#数据合并" class="headerlink" title="数据合并"></a>数据合并</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; data</div><div class="line">  name  price</div><div class="line">0  BTC  50000</div><div class="line">1  ETH   4000</div><div class="line">2   ae    200</div><div class="line">3  eos    eos</div><div class="line"></div><div class="line">&gt;&gt;&gt; data1</div><div class="line">  name other</div><div class="line">0  BTC     a</div><div class="line">1  ETH     b</div><div class="line"></div><div class="line"># 以name为key进行左连接</div><div class="line">&gt;&gt;&gt; pd.merge(data,data1,on=&apos;name&apos;,how=&apos;left&apos;)</div><div class="line">  name  price other</div><div class="line">0  BTC  50000     a</div><div class="line">1  ETH   4000     b</div><div class="line">2   ae    200   NaN</div><div class="line">3  eos    eos   NaN</div></pre></td></tr></table></figure>
<p>平时进行数据合并操作，更多的会出一种情况，那就是出现重复值，DataFrame也为我们提供了简便的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.drop_duplicates(inplace=True)</div></pre></td></tr></table></figure>
<h6 id="数据的简单保存与读取"><a href="#数据的简单保存与读取" class="headerlink" title="数据的简单保存与读取"></a>数据的简单保存与读取</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; data.to_csv(&apos;test.csv&apos;)</div><div class="line">&gt;&gt;&gt; pd.read_csv(&apos;test.csv&apos;)</div><div class="line">   Unnamed: 0 name  price</div><div class="line">0           0  BTC  50000</div><div class="line">1           1  ETH   4000</div><div class="line">2           2   ae    200</div><div class="line">3           3  eos    eos</div></pre></td></tr></table></figure>
<p>为什么会出现这种情况呢，从头看到尾的同学可能就看出来了，增加第三行时，我用的是loc[‘3’]行标签来增加的，而read_csv方法是默认index是从0开始增长的，此时只需要我们设置下index参数就ok了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># 不保存行索引</div><div class="line">&gt;&gt;&gt; data.to_csv(&apos;test.csv&apos;,index=None)</div><div class="line">&gt;&gt;&gt; pd.read_csv(&apos;test.csv&apos;)</div><div class="line">  name  price</div><div class="line">0  BTC  50000</div><div class="line">1  ETH   4000</div><div class="line">2   ae    200</div><div class="line">3  eos    eos</div></pre></td></tr></table></figure>
<p>其他的还有header参数，这些参数都是我们在保存数据时需要注意的。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fingerchou.com/2018/08/23/numpy-basis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Finger Chou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Finger's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/23/numpy-basis/" itemprop="url">Numpy基础</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-23T22:19:00+08:00">
                2018-08-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/23/numpy-basis/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/23/numpy-basis/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/08/23/numpy-basis/" class="leancloud_visitors" data-flag-title="Numpy基础">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文地址：<a href="https://www.jiqizhixin.com/articles/2018-07-18-2" target="_blank" rel="external">https://www.jiqizhixin.com/articles/2018-07-18-2</a></p>
<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>numpy是专门为科学计算设计的一个python扩展包，为python提供高效率的多维数组，也被称为面向阵列计算（array oriented computing），同时numpy也是github上的一个开源项目：numpy，numpy是基于c语言开发，所以这使得numpy的运行速度很快，高效率运行就是numpy的一大优势。</p>
<p>用numpy生成一维数组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; import numpy as np</div><div class="line">&gt;&gt;&gt; a = np.array([[1,2,3]], dtype=np.int32)</div><div class="line">&gt;&gt;&gt; a</div><div class="line">array([[1, 2, 3]])</div></pre></td></tr></table></figure></p>
<p>numpy中定义的最重要的数据结构是称为ndarray的n维数组类型，这个结构引用了两个对象，一块用于<strong>保存数据的存储区域</strong>和一个<strong>用于描述元素类型的dtype对象</strong>： </p>
<p><img src="/imgs/20180823/20180516210240962.jpg" alt=""></p>
<h4 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h4><p>二维数组的生成在python中我们还可以用到list列表，如果用list来表示[1,2,3]，由于list中的元素可以是任何对象，所以list中保存的是对象的指针，如果要保存[1,2,3]就需要三个指针和三个整数对象，是比较浪费内存资源和cpu计算时间的，而ndarray是一种保存单一数据类型的多维数组结构，在数据处理上比list列表要快上很多。</p>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><h5 id="生成一个3x3的矩阵"><a href="#生成一个3x3的矩阵" class="headerlink" title="生成一个3x3的矩阵"></a>生成一个3x3的矩阵</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; import numpy as np</div><div class="line">&gt;&gt;&gt; data = np.array([[1,2,3],[4,5,6],[7,8,9]])</div><div class="line">&gt;&gt;&gt; data</div><div class="line">array([[1, 2, 3],</div><div class="line">       [4, 5, 6],</div><div class="line">       [7, 8, 9]])</div><div class="line"></div><div class="line"># 等价于data=np.arange(1，10).reshape(3,3)</div><div class="line">&gt;&gt;&gt; data = np.arange(1,10).reshape(3,3)</div><div class="line">&gt;&gt;&gt; data</div><div class="line">array([[1, 2, 3],</div><div class="line">       [4, 5, 6],</div><div class="line">       [7, 8, 9]])</div></pre></td></tr></table></figure>
<h5 id="查看矩阵信息"><a href="#查看矩阵信息" class="headerlink" title="查看矩阵信息"></a>查看矩阵信息</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># 返回元组，表示n行n列</div><div class="line">&gt;&gt;&gt; data.shape</div><div class="line">(3, 3)</div><div class="line"></div><div class="line"># 返回数组数据类型</div><div class="line">&gt;&gt;&gt; data.dtype</div><div class="line">dtype(&apos;int32&apos;)</div><div class="line"></div><div class="line"># 返回是几维数组</div><div class="line">&gt;&gt;&gt; data.ndim</div><div class="line">2</div></pre></td></tr></table></figure>
<h5 id="转换数据类型"><a href="#转换数据类型" class="headerlink" title="转换数据类型"></a>转换数据类型</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># 拷贝一份新的数组</div><div class="line">&gt;&gt;&gt; a = data.astype(float)</div><div class="line">&gt;&gt;&gt; a</div><div class="line">array([[1., 2., 3.],</div><div class="line">       [4., 5., 6.],</div><div class="line">       [7., 8., 9.]])</div><div class="line">&gt;&gt;&gt; a.dtype</div><div class="line">dtype(&apos;float64&apos;)</div></pre></td></tr></table></figure>
<h5 id="数组之间的计算"><a href="#数组之间的计算" class="headerlink" title="数组之间的计算"></a>数组之间的计算</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; data + data</div><div class="line">array([[ 2,  4,  6],</div><div class="line">       [ 8, 10, 12],</div><div class="line">       [14, 16, 18]])</div><div class="line">&gt;&gt;&gt; data * data</div><div class="line">array([[ 1,  4,  9],</div><div class="line">       [16, 25, 36],</div><div class="line">       [49, 64, 81]])</div></pre></td></tr></table></figure>
<p>可以看出相同规格的数组计算是直接作用在其元素级上的，那不同的规格的数组是否能进行运算呢，我们来看下这个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># 生成一个2x2numpy数组</div><div class="line">&gt;&gt;&gt; data1 = np.array([[1,2],[1,2]])</div><div class="line">&gt;&gt;&gt; data + data1</div><div class="line">Traceback (most recent call last):</div><div class="line">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</div><div class="line">ValueError: operands could not be broadcast together with shapes (3,3) (2,2)</div></pre></td></tr></table></figure></p>
<p>我们可以看出不同规格的数组一起计算的话是会报出<strong>广播错误</strong>的，那是不是可以下结论了，别急我们再来看下方两个特殊例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; data2 = np.array([[1,2,3]])</div><div class="line">&gt;&gt;&gt; data + data2</div><div class="line">array([[ 2,  4,  6],</div><div class="line">       [ 5,  7,  9],</div><div class="line">       [ 8, 10, 12]])</div><div class="line">&gt;&gt;&gt; data3 = np.array([[1], [2], [3]])</div><div class="line">&gt;&gt;&gt; data + data3</div><div class="line">array([[ 2,  3,  4],</div><div class="line">       [ 6,  7,  8],</div><div class="line">       [10, 11, 12]])</div></pre></td></tr></table></figure></p>
<p>data2数组的列数量与data数组相等，data3数组的行数量与data数组相等，这两个numpy数组虽然规格与data数组不一样，但却依然可以与data数组进行运算。</p>
<h5 id="数据的切片"><a href="#数据的切片" class="headerlink" title="数据的切片"></a>数据的切片</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"># 沿着行(axis=0)进行索引</div><div class="line">&gt;&gt;&gt; data[:2]</div><div class="line">array([[1, 2, 3],</div><div class="line">       [4, 5, 6]])</div><div class="line"></div><div class="line"># 先沿着行(axis=0)进行索引，再沿着列(axis=1)进行索引</div><div class="line">&gt;&gt;&gt; data[:2, :2]</div><div class="line">array([[1, 2],</div><div class="line">       [4, 5]])</div><div class="line"></div><div class="line"># 下标是从0开始</div><div class="line">&gt;&gt;&gt; data[1,0:2]</div><div class="line">array([4, 5])</div></pre></td></tr></table></figure>
<p>这里需要注意的是，切片操作是在原始数组上创建一个视图view，这只是访问数组数据的一种方式。 因此原始数组不会被复制到内存中，传递的是一个类似引用的东西，与上面的astype（）方法是两种不同的拷贝方式，这里我们来看一个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; a = data[1]</div><div class="line">&gt;&gt;&gt; a</div><div class="line">array([4, 5, 6])</div><div class="line">&gt;&gt;&gt; a[:] = 0</div><div class="line">&gt;&gt;&gt; data</div><div class="line">array([[1, 2, 3],</div><div class="line">       [0, 0, 0],</div><div class="line">       [7, 8, 9]])</div></pre></td></tr></table></figure></p>
<p>当切片对象a改变时，data的对应值也会跟着改变，这是在我们日常数据处理中有时会疏忽的一个点，最安全的复制方法是使用copy（）方法进行浅拷贝：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; a = data[1].copy()</div><div class="line">&gt;&gt;&gt; a</div><div class="line">array([0, 0, 0])</div><div class="line">&gt;&gt;&gt; a[:] = 9</div><div class="line">&gt;&gt;&gt; data</div><div class="line">array([[1, 2, 3],</div><div class="line">       [0, 0, 0],</div><div class="line">       [7, 8, 9]])</div></pre></td></tr></table></figure></p>
<h5 id="数组的布尔索引"><a href="#数组的布尔索引" class="headerlink" title="数组的布尔索引"></a>数组的布尔索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; data</div><div class="line">array([[1, 2, 3],</div><div class="line">       [4, 5, 6],</div><div class="line">       [7, 8, 9]])</div><div class="line">&gt;&gt;&gt; data &gt; 3</div><div class="line">array([[False, False, False],</div><div class="line">       [ True,  True,  True],</div><div class="line">       [ True,  True,  True]])</div><div class="line"># 找出大于3的元素</div><div class="line">&gt;&gt;&gt; data[data &gt; 3]</div><div class="line">array([4, 5, 6, 7, 8, 9])</div></pre></td></tr></table></figure>
<h5 id="数组的逻辑表达处理"><a href="#数组的逻辑表达处理" class="headerlink" title="数组的逻辑表达处理"></a>数组的逻辑表达处理</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># 大于3的标记为1，小于等于3的标记为0</div><div class="line">&gt;&gt;&gt; np.where(data&gt;3,1,0)</div><div class="line">array([[0, 0, 0],</div><div class="line">       [1, 1, 1],</div><div class="line">       [1, 1, 1]])</div></pre></td></tr></table></figure>
<h5 id="数组的常用统计操作"><a href="#数组的常用统计操作" class="headerlink" title="数组的常用统计操作"></a>数组的常用统计操作</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"># 沿着行(axis=0)进行索引，求出其平均值</div><div class="line">&gt;&gt;&gt; data.mean(axis=0)</div><div class="line">array([4., 5., 6.])</div><div class="line"># 求出全部元素的方差</div><div class="line">&gt;&gt;&gt; data.std()</div><div class="line">2.581988897471611</div><div class="line"># 统计数组中元素大于3的个数</div><div class="line">&gt;&gt;&gt; (data &gt; 3).sum()</div><div class="line">6</div><div class="line"></div><div class="line"># 数组中是否存在一个或多个true</div><div class="line">&gt;&gt;&gt; data.any()</div><div class="line">True</div><div class="line"></div><div class="line"># 数组中是否全部数都是true</div><div class="line">&gt;&gt;&gt; data.all()</div><div class="line">True</div><div class="line"></div><div class="line"># 沿着行(axis=0)进行索引，进行累加</div><div class="line">&gt;&gt;&gt; data.cumsum(0)</div><div class="line">array([[ 1,  2,  3],</div><div class="line">       [ 5,  7,  9],</div><div class="line">       [12, 15, 18]], dtype=int32)</div><div class="line"></div><div class="line"># 沿着列(axis=1)进行索引，进行累乘</div><div class="line">&gt;&gt;&gt; data.cumprod(1)</div><div class="line">array([[  1,   2,   6],</div><div class="line">       [  4,  20, 120],</div><div class="line">       [  7,  56, 504]], dtype=int32)</div></pre></td></tr></table></figure>
<h5 id="数组的排序操作"><a href="#数组的排序操作" class="headerlink" title="数组的排序操作"></a>数组的排序操作</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; data = np.random.randn(4,4)</div><div class="line">&gt;&gt;&gt; data</div><div class="line">array([[-2.09150248, -0.07758111, -1.30427684, -0.79387749],</div><div class="line">       [-0.10272387, -0.89728241, -0.54607326,  0.87435473],</div><div class="line">       [ 1.83972061, -0.81256093, -1.21652558,  0.51171488],</div><div class="line">       [-0.40912271,  0.21529186,  0.66593734, -0.54275447]])</div><div class="line"></div><div class="line"># 沿着行(axis=0)进行索引，并进行升序排序</div><div class="line">&gt;&gt;&gt; data.sort(0)</div><div class="line">&gt;&gt;&gt; data</div><div class="line">array([[-2.09150248, -0.89728241, -1.30427684, -0.79387749],</div><div class="line">       [-0.40912271, -0.81256093, -1.21652558, -0.54275447],</div><div class="line">       [-0.10272387, -0.07758111, -0.54607326,  0.51171488],</div><div class="line">       [ 1.83972061,  0.21529186,  0.66593734,  0.87435473]])</div><div class="line"></div><div class="line"># 降序操作</div><div class="line">&gt;&gt;&gt; data[::-1]</div><div class="line">array([[ 1.83972061,  0.21529186,  0.66593734,  0.87435473],</div><div class="line">       [-0.10272387, -0.07758111, -0.54607326,  0.51171488],</div><div class="line">       [-0.40912271, -0.81256093, -1.21652558, -0.54275447],</div><div class="line">       [-2.09150248, -0.89728241, -1.30427684, -0.79387749]])</div></pre></td></tr></table></figure>
<p><strong>注意：直接调用数组的方法的排序将直接改变数组而不会产生新的拷贝。</strong></p>
<h5 id="矩阵运算"><a href="#矩阵运算" class="headerlink" title="矩阵运算"></a>矩阵运算</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; x=np.arange(9).reshape(3,3)</div><div class="line">&gt;&gt;&gt; x</div><div class="line">array([[0, 1, 2],</div><div class="line">       [3, 4, 5],</div><div class="line">       [6, 7, 8]])</div><div class="line"># 矩阵相乘</div><div class="line">&gt;&gt;&gt; np.dot(x, x)</div><div class="line">array([[ 15,  18,  21],</div><div class="line">       [ 42,  54,  66],</div><div class="line">       [ 69,  90, 111]])</div><div class="line"># 矩阵转置</div><div class="line">&gt;&gt;&gt; x.T</div><div class="line">array([[0, 3, 6],</div><div class="line">       [1, 4, 7],</div><div class="line">       [2, 5, 8]])</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fingerchou.com/2018/07/15/a-best-practice-of-bitwise-operation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Finger Chou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Finger's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/15/a-best-practice-of-bitwise-operation/" itemprop="url">位运算的最佳实践</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-15T14:30:00+08:00">
                2018-07-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/15/a-best-practice-of-bitwise-operation/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/15/a-best-practice-of-bitwise-operation/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/07/15/a-best-practice-of-bitwise-operation/" class="leancloud_visitors" data-flag-title="位运算的最佳实践">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>问：假设 S由a, b, c三个数值组成, S的大小为2个字节(Byte)。已知S的值。求解a, b, c分别是多少？<br>其中a = 4 Bit, b = 4 Bit, c = 8 Bit。(a &gt;= 0, b &gt;= 0, c &gt;= 0)</p>
<p>解：</p>
<p>如图所示：<br><img src="/imgs/20180715/s.png" alt=""></p>
<ul>
<li>a 为前4 Bit，则a = S &gt;&gt; 12</li>
<li>b 为a后4 Bit，则b = S &gt;&gt; 8 &amp; 0b1111</li>
<li>c 为最后8 Bit, 则c = S &amp; 0b11111111</li>
</ul>
<p>假定S = 10086，则：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; S = 10086</div><div class="line">&gt;&gt;&gt; a = S &gt;&gt; 12</div><div class="line">&gt;&gt;&gt; b = S &gt;&gt; 8 &amp; 0b1111</div><div class="line">&gt;&gt;&gt; c = S &amp; 0b11111111</div><div class="line">&gt;&gt;&gt; print(a, b, c)</div><div class="line">2 7 102</div></pre></td></tr></table></figure>
<p>验证一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; a = 2</div><div class="line">&gt;&gt;&gt; b = 7</div><div class="line">&gt;&gt;&gt; c = 102</div><div class="line">&gt;&gt;&gt; S = (a &lt;&lt; 12) + (b &lt;&lt; 8) + c</div><div class="line">&gt;&gt;&gt; S</div><div class="line">10086</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fingerchou.com/2018/07/14/using-fibonacci-sequence-to-encrypt/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Finger Chou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Finger's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/14/using-fibonacci-sequence-to-encrypt/" itemprop="url">使用斐波拉契数列来做加密解密</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-14T22:23:00+08:00">
                2018-07-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/14/using-fibonacci-sequence-to-encrypt/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/14/using-fibonacci-sequence-to-encrypt/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/07/14/using-fibonacci-sequence-to-encrypt/" class="leancloud_visitors" data-flag-title="使用斐波拉契数列来做加密解密">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="一、斐波那契数列定义"><a href="#一、斐波那契数列定义" class="headerlink" title="一、斐波那契数列定义"></a>一、斐波那契数列定义</h4><p>斐波那契数列（Fibonacci sequence），又称黄金分割数列、因数学家列昂纳多·斐波那契（Leonardoda Fibonacci）以兔子繁殖为例子而引入，故又称为“兔子数列”，指的是这样一个数列：1、1、2、3、5、8、13、21、34、……</p>
<p>数学表达式：<br>F(1)=1，F(2)=1, F(n)=F(n-1)+F(n-2)（n&gt;=2，n∈N*）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fib = lambda n: n if n &lt;= 2 else fib(n - 1) + fib(n - 2)</div></pre></td></tr></table></figure>
<h4 id="二、异或"><a href="#二、异或" class="headerlink" title="二、异或"></a>二、异或</h4><p>运算规则：如果a、b两个值不相同，则异或结果为1。如果a、b两个值相同，异或结果为0。<br>特性：同一变量与另一变量和其异或值异或等于另一个数，如（a ^ b）^ b = a。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; a = 2</div><div class="line">&gt;&gt;&gt; b = 3</div><div class="line">&gt;&gt;&gt; c = a ^ b</div><div class="line">&gt;&gt;&gt; c ^ b</div><div class="line">2</div></pre></td></tr></table></figure>
<h4 id="三、加密解密逻辑"><a href="#三、加密解密逻辑" class="headerlink" title="三、加密解密逻辑"></a>三、加密解密逻辑</h4><ul>
<li>1、定义斐波那契数列，用来做密码表。</li>
<li>2、将秘钥字符串与斐波拉契数列做关联，进行加密计算得到新的密码表。</li>
<li>3、加密，需要加密的原始字符串与加密计算后的新密码表进行异或，得到加密之后的字符串。</li>
<li>4、解密，把加密后的字符串与加密计算后的新密码表再进行异或就得到原始字符串</li>
</ul>
<h4 id="四、代码实现"><a href="#四、代码实现" class="headerlink" title="四、代码实现"></a>四、代码实现</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"># [1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144...]</div><div class="line">_fib = [1] * 64</div><div class="line"></div><div class="line"># 初始化斐波拉契数列，本例定义数列大小为64</div><div class="line">def __init_fib():</div><div class="line">    for i in range(2, 64):</div><div class="line">        _fib[i] = _fib[i-1] + _fib[i-2]</div><div class="line">__init_fib()</div><div class="line"></div><div class="line">def encrypt(source, secret):</div><div class="line">    if not source or not secret:</div><div class="line">        return source</div><div class="line"></div><div class="line">    # 将字符串转成对应字符的ascii码数值</div><div class="line">    src_list = list(map(ord, source))</div><div class="line">    key_list = list(map(ord, secret))</div><div class="line">    key_len = len(key_list)</div><div class="line"></div><div class="line">    # 32 &lt;= N &lt;= 64</div><div class="line">    N = max(sum(key_list) &amp; 0x3F, 32)</div><div class="line">    # 将秘钥字符串与斐波拉契数列做加密计算，生成新的列表</div><div class="line">    # 保证计算后的数值小于255</div><div class="line">    tmp = [(key_list[_fib[i] % key_len] + _fib[i]) &amp; 0xFF for i in range(N)]</div><div class="line">    # 将原始字符串与新生成的列表做异或</div><div class="line">    dst_list = [src_list[i] ^ tmp[i % N] for i in range(len(src_list))]</div><div class="line">    # chr 将范围[0-255]之间的数字转换成ascii码字符</div><div class="line">    return &apos;&apos;.join(list(map(chr, dst_list)))</div><div class="line"></div><div class="line"></div><div class="line"># 对称加密，加密即是解密</div><div class="line">decrypt = encrypt</div><div class="line"></div><div class="line"></div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    secret_key = &apos;have a nice day&apos;</div><div class="line">    dst_string = encrypt(&apos;FingerChou&apos;, secret_key)</div><div class="line">    print(dst_string)</div><div class="line">    print(decrypt(dst_string, secret_key))</div></pre></td></tr></table></figure>
<h4 id="五、综述"><a href="#五、综述" class="headerlink" title="五、综述"></a>五、综述</h4><p>上述只是利用斐波拉契数列进行了简单的加密计算。如果知道数列也就知道密码了。<br>虽然我们还增加了秘钥字符串。增加了复杂性。但是实际应用中，还是要把生成密码表的算法设计的更复杂一点。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fingerchou.com/2018/06/24/inverse-matrix-with-numpy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Finger Chou">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Finger's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/24/inverse-matrix-with-numpy/" itemprop="url">用Numpy求矩阵的逆</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-24T19:02:00+08:00">
                2018-06-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Numpy/" itemprop="url" rel="index">
                    <span itemprop="name">Numpy</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/24/inverse-matrix-with-numpy/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/06/24/inverse-matrix-with-numpy/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/06/24/inverse-matrix-with-numpy/" class="leancloud_visitors" data-flag-title="用Numpy求矩阵的逆">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>一个n阶方阵A称为可逆的，或非奇异的，如果存在一个n阶方阵B，使得</p>
<p><strong>AB = BA = E</strong></p>
<p>并称B是A的一个逆矩阵。A的逆矩阵记作A^-1。</p>
<p>百度<a href="https://baike.baidu.com/item/%E9%80%86%E7%9F%A9%E9%98%B5" target="_blank" rel="external">逆矩阵</a></p>
<h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><p>若|A|≠0，则矩阵A可逆，且</p>
<p><img src="/imgs/20180624/1.png" alt=""></p>
<p>其中，A*为矩阵A的伴随矩阵。</p>
<h3 id="求解"><a href="#求解" class="headerlink" title="求解"></a>求解</h3><p>假定矩阵A为:</p>
<p><img src="/imgs/20180624/2.png" alt=""></p>
<p>根据公式:</p>
<p><img src="/imgs/20180624/3.png" alt=""></p>
<p>因A可逆，则有A的<a href="https://baike.baidu.com/item/%E4%BC%B4%E9%9A%8F%E7%9F%A9%E9%98%B5" target="_blank" rel="external">伴随矩阵</a>特性 A* = A^T </p>
<p><img src="/imgs/20180624/4.png" alt=""></p>
<p>根据<a href="https://baike.baidu.com/item/%E4%B8%89%E9%98%B6%E8%A1%8C%E5%88%97%E5%BC%8F" target="_blank" rel="external">三阶行列式</a>特性（对角线法）|A| = (1 x 1) - (-1 x 1)</p>
<p><img src="/imgs/20180624/5.png" alt=""></p>
<p>代入公式：</p>
<p><img src="/imgs/20180624/6.png" alt=""></p>
<h3 id="用Numpy求矩阵的逆"><a href="#用Numpy求矩阵的逆" class="headerlink" title="用Numpy求矩阵的逆"></a>用Numpy求矩阵的逆</h3><p>numpy.linalg中的<code>inv()</code>函数就是用来求矩阵的逆。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; A = np.mat(&quot;1 -1; 1 1&quot;)</div><div class="line">&gt;&gt;&gt; A</div><div class="line">matrix([[ 1, -1],</div><div class="line">        [ 1,  1]])</div><div class="line">&gt;&gt;&gt; inverse = np.linalg.inv(A)</div><div class="line">&gt;&gt;&gt; inverse</div><div class="line">matrix([[ 0.5,  0.5],</div><div class="line">        [-0.5,  0.5]])</div></pre></td></tr></table></figure>
<p>感觉是不是很简单。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Finger Chou</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">37</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">27</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/zhoujun" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:finger.zhou@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Finger.Chou</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count"></span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script>
    

    

  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("MQheTKqTvNfaqOGpfvs7Aj1E-gzGzoHsz", "x1apPei1gmHTmq15yF9AXo2F");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
